rm vivipos_sdk_*_*.zip vivipos_sdk_*_*.sha1
rel_date=`date +'%Y%m%d%H%M%S'`
version=`cat VERSION`	

filename=vivipos_sdk_${version}_${rel_date}.zip

sha1_filename=vivipos_sdk_${version}_${rel_date}.sha1
sha1deep -r -l chrome components defaults extensions modules plugins xulrunner getSystemLicenseStub matchbox-keyboard run_vivipos vivipos > ${sha1_filename}
sha1sum=`sha1deep < ${sha1_filename}`

regsum="s/^ApplicationHash=.*/ApplicationHash=${sha1sum}/g"

sed ${regsum} application.ini > application-sum.ini
mv application-sum.ini application.ini


regex1="s/^Version=.*/Version=${version}/g"
regex2="s/^BuildID=.*/BuildID=${rel_date}/g"

sed ${regex1} application.ini > application-new.ini

if [ "$1" != "no" ]; then
  sed ${regex2} application-new.ini > application.ini
fi

rm -f application-new.ini

zip -y -r ${filename} * -x@exclude.lst

