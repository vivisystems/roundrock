#!/bin/sh

#
# vivipos launcher
# 
. /etc/environment

RETVAL=127;
DIR=`dirname $0`
DATABASE=/data/databases
SQLITE3=/usr/bin/sqlite3

#
# do sqlite vacuum 
#
do_vacuum()
{

    for i in $DATABASE/*.sqlite; do
        echo "VACUUM;" | $SQLITE3 $i ;
    done

    chmod -R 775 $DATABASE ;
}


while [ $RETVAL != 0 ]; do
    /usr/bin/aosd_cat -d 8000 "Starting VIVIPOS ......" &

    do_vacuum

    ${DIR}/vivipos
    RETVAL=$?

done

